<html>
    <head>
        <title>Airplanes</title>
    </head>
    <body>
        <style>html{background-color:#000;color:#fff;font-size:32px;font-family:'Courier New',Courier,monospace}button{margin:.25rem;padding:.25rem;background-color:#000;color:#fff;border:1px solid grey}button.selected{background-color:grey}.block{display:inline-block;margin:.5rem}.square{display:inline-block;width:1rem;height:1rem;overflow:hidden;font-size:.75rem}.border{box-shadow:1px 0 0 0 #888,0 1px 0 0 #888,1px 1px 0 0 #888,1px 0 0 0 #888 inset,0 1px 0 0 #888 inset}.plane-tmp{background-color:orange}.plane{background-color:#87cefa}.hit{background-color:grey}.plane.hit{background-color:orange}.plane.tip.hit{background-color:red}.rotate{width:calc(100% - .5rem)}.game-over{position:fixed;top:0;bottom:0;left:0;right:0;background-color:rgba(0,0,0,.753)}.game-over>*{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);white-space:nowrap}.game-over>.won{color:#adff2f}.game-over>.lost{color:red}</style>
        <script type="module">(()=>{var r={myField:"my-field",opponentField:"opponent-field",planeField:"plane-field"},l,u=!0;Promise.resolve().then(async()=>{await P(),_(),R(),l.my.planes.forEach(e=>b(r.myField,e)),m(!1),l.my.planes.length!==2?O():(v(),m(!0))}).catch(e=>{document.body.innerHTML=`<button onclick="javascript:location.reload()">reload</button><br><br>${e.stack}`});function _(){if(l.my.planes.length>0)return;let e=["easy","medium","hard","impossible"],t=p("div");e.forEach(o=>{let i=p("button");i.classList.add("level",o),i.textContent=o,i.addEventListener("click",()=>n(o)),t.appendChild(i)}),document.body.appendChild(t);let s=localStorage.getItem("level");n(e.includes(s)?s:"medium");function n(o){!o||l.my.planes.length>0||(localStorage.setItem("level",o),document.querySelectorAll("button.level").forEach(i=>{i.classList.contains(o)?i.classList.add("selected"):i.classList.remove("selected")}))}}async function P(){l=await Promise.resolve({my:{planes:[],shots:[]},opponent:{planes:[],shots:[]}})}function R(){L(r.myField,(e,t)=>{l.my.planes.length!==2&&(D("my",l.my.planes,S(),e,t),l.my.planes.length===2&&(document.body.removeChild(document.getElementById(r.planeField)),v()))})}function v(){L(r.opponentField,(e,t)=>Z(h(e,t)).then(B),"opponent"),G()}function G(){for(;l.opponent.planes.length!==2;)D("opponent",l.opponent.planes,f(4),f(10),f(10))}function B(){let e={easy:()=>[f(10),f(10)],normal:()=>e.easy(),hard:()=>E(l.my.planes.flatMap(n=>n).reverse()[l.opponent.shots.length]),impossible:()=>E(l.my.planes[l.opponent.shots.length][0])},[t,s]=(e[localStorage.getItem("level")]||e.normal)();q(h(t,s))}function O(){let e=p("button");e.classList.add("rotate"),e.textContent="rotate",e.addEventListener("click",s);let t=p("div");t.classList.add("block"),t.setAttribute("id",r.planeField),F(t,4),t.appendChild(document.createElement("br")),t.appendChild(e),document.body.appendChild(t),s(new Event("init"));function s(n){let o=S(),i=o+(n===void 0?0:o>=4?-3:1),a=document.querySelector(`#${r.planeField}`);n&&a.setAttribute("orientation",i);let d=A(i);a.querySelectorAll("[cell]").forEach(c=>d.includes(c.getAttribute("cell"))?c.classList.add("plane-tmp"):c.classList.remove("plane-tmp"))}}function L(e,t,s){let n=document.createElement("div");n.setAttribute("id",e),n.classList.add("block"),F(n,10,!0,t,s),document.body.appendChild(n)}function S(){let e=document.querySelector(`#${r.planeField}`),t=e&&+e.getAttribute("orientation")||1;return t>4?1:t}async function Z(e){if(!u||!await Promise.resolve(u))return;if(u=!1,!l.my.shots.includes[e]){l.my.shots.push(e);let n=0;l.opponent.planes.find(i=>i[0]===e)!==void 0?n=2:l.opponent.planes.find(i=>i.includes(e))!==void 0&&(n=1);let o=document.querySelector(`#${r.opponentField} [cell='${e}']`);n>0&&o.classList.add("plane"),n===2&&o.classList.add("tip"),n===3&&s(!0)}s(I(l.opponent.planes,l.my.shots));function s(n){m(!0,e),n&&C("my")}}function q(e){u||(l.opponent.shots.includes[e]||l.opponent.shots.push(e),m(!1,e),I(l.my.planes,l.opponent.shots)&&C("opponent"),u=!0)}function C(e){let t=document.createElement("div");t.innerHTML=e==="my"?"You won :)":"You lost :(",t.classList.add(e==="my"?"won":"lost");let s=document.createElement("div");s.classList.add("game-over"),s.addEventListener("click",()=>location.reload()),s.appendChild(t),document.body.appendChild(s)}function I(e,t){let s=e.map(o=>o[0]);return t.filter(o=>s.includes(o)).length===2}function b(e,t){t.forEach((s,n)=>{let o=document.querySelector(`#${e} [cell='${s}']`);o.classList.add("plane"),n===0&&o.classList.add("tip")})}function m(e,t){let s=document.getElementById(e?r.opponentField:r.myField);t?n(t):e?l.my.shots.forEach(n):l.opponent.shots.forEach(n);function n(o){let i=s.querySelector(`[cell='${o}']`);i.classList.contains("hit")||i.classList.add("hit")}}function F(e,t,s,n,o){if(s===!0){let a=document.createElement("div");for(let d=0;d<=t;d++){let c=p("div");c.classList.add("square"),c.innerHTML=d>0?d:"",a.appendChild(c)}e.appendChild(a)}for(let a=1;a<=t;a++)for(let d=1;d<=t;d++)i(a,d);function i(a,d){if(d%t===1&&(a>1&&e.appendChild(p("br")),s===!0)){let y=p("div");y.classList.add("square"),y.innerHTML=g(a),e.appendChild(y)}let c=p("div");c.classList.add("square","border"),o&&c.classList.add(o),c.setAttribute("cell",h(a,d)),n&&c.addEventListener("click",()=>n(a,d)),e.appendChild(c)}}function A(e,t,s){let o={1:["A2","B1","B2","B3","C2","D1","D2","D3"],2:["B4","A1","A3","B1","B2","B3","C1","C3"],3:["D2","A1","A2","A3","B2","C1","C2","C3"],4:["B1","A2","A4","B2","B3","B4","C2","C4"]}[e];return!t||!s?o:o.map(i=>{let a=E(i);return a[0]+=e===1?t-1:e==2||e==4?t-2:e===3?t-4:t,a[1]+=e===1||e===3?s-2:e==2?s-4:e===4?s-1:s,h(...a)})}function D(e,t,s,n,o){if(!(s===1&&n>=1&&n<=10-3&&o>=2&&o<=10-1||s===2&&n>=2&&n<=10-1&&o>=4&&o<=10||s===3&&n>=4&&n<=10&&o>=2&&o<=10-1||s===4&&n>=2&&n<=10-1&&o>=1&&o<=10-3))return;let i=A(s,n,o);t.find(d=>d.find(c=>i.includes(c))!==void 0)||(t.push(i),e==="my"&&b(r.myField,i))}function p(e){return document.createElement(e)}function f(e){return Math.ceil(Math.random()*e)}function E(e){return[(e||"")[0]?.charCodeAt()-64||0,+(e||"")[1]]}function h(e,t){return`${g(e)}${t}`}function g(e){return String.fromCharCode(64+e)}})();</script>
    </body>
</html>
