<html>
    <head>
        <title>Airplanes</title>
    </head>
    <body>
        <style>
            html{background-color:#000;color:#fff;font-size:32px;font-family:'Courier New',Courier,monospace}button{margin:.25rem;padding:.25rem;background-color:#000;color:#fff;border:1px solid grey}button.selected{background-color:grey}table{border-collapse:collapse}td{width:1rem;height:1rem;overflow:hidden;font-size:.75rem;overflow:hidden;padding:0;text-align:center}td[cell]{border:1px solid grey}.block{display:inline-block;margin:.5rem}.square{display:inline-block;width:1rem;height:1rem;overflow:hidden;font-size:.75rem}.border{box-shadow:1px 0 0 0 #888,0 1px 0 0 #888,1px 1px 0 0 #888,1px 0 0 0 #888 inset,0 1px 0 0 #888 inset}.plane-tmp{background-color:orange}.plane{background-color:#87cefa}.hit{background-color:grey}.plane.hit{background-color:orange}.plane.tip.hit{background-color:red}.rotate{width:calc(100% - .5rem)}.game-over{position:fixed;top:0;bottom:0;left:0;right:0;background-color:rgba(0,0,0,.753)}.game-over>*{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);white-space:nowrap}.game-over>.won{color:#adff2f}.game-over>.lost{color:red}
        </style>
        <script type="module">
            (()=>{var a={myField:"my-field",opponentField:"opponent-field",planeField:"plane-field"},i;Promise.resolve().then(async()=>{await R(),b(),N(),i.my.planes.forEach(e=>F(a.myField,e)),y(!1),i.my.planes.length!==2?O():(L(),y(!0))}).catch(e=>{document.body.innerHTML=`<button onclick="javascript:location.reload()">reload</button><br><br>${e.stack}`});function b(){if(i.my.planes.length>0)return;let e=["easy","medium","hard","impossible"],s=m("div");e.forEach(t=>{let l=m("button");l.classList.add("level",t),l.textContent=t,l.addEventListener("click",()=>o(t)),s.appendChild(l)}),document.body.appendChild(s);let n=localStorage.getItem("level");o(e.includes(n)?n:"medium");function o(t){!t||i.my.planes.length>0||(localStorage.setItem("level",t),document.querySelectorAll("button.level").forEach(l=>{l.classList.contains(t)?l.classList.add("selected"):l.classList.remove("selected")}))}}async function R(){i=await Promise.resolve({my:{planes:[],shots:[]},opponent:{planes:[],shots:[]}})}function N(){v(document.body,10,(e,s)=>{i.my.planes.length!==2&&(P("my",i.my.planes,g(),e,s),i.my.planes.length===2&&(document.body.removeChild(document.getElementById(a.planeField)),L()))},!0,a.myField,"block")}function L(){v(document.body,10,(e,s)=>$(S(e,s)).then(G),!0,a.opponentField,"block"),Z()}function Z(){for(;i.opponent.planes.length!==2;)P("opponent",i.opponent.planes,h(4),h(10),h(10))}async function G(){let e={easy:()=>[h(10),h(10)],normal:()=>e.easy(),hard:()=>E(i.my.planes.flatMap(o=>o).reverse()[i.opponent.shots.length]),impossible:()=>E(i.my.planes[i.opponent.shots.length][0])},[s,n]=(e[localStorage.getItem("level")]||e.normal)();await B(S(s,n))}function O(){v(document.body,4,e,!1,a.planeField,"block"),e(new Event("init"));function e(s){let n=g(),o=n+(s===void 0?0:n>=4?-3:1),t=document.querySelector(`#${a.planeField}`);s&&t.setAttribute("orientation",o);let l=D(o);t.querySelectorAll("[cell]").forEach(c=>l.includes(c.getAttribute("cell"))?c.classList.add("plane-tmp"):c.classList.remove("plane-tmp"))}}function g(){let e=document.querySelector(`#${a.planeField}`),s=e&&+e.getAttribute("orientation")||1;return s>4?1:s}async function $(e){if(!T())return;if(!i.my.shots.includes[e]){i.my.shots.push(e);let n=0;i.opponent.planes.find(t=>t[0]===e)?n=2:i.opponent.planes.find(t=>t.includes(e))&&(n=1);let o=document.querySelector(`#${a.opponentField} [cell='${e}']`);n>0&&o.classList.add("plane"),n===2&&o.classList.add("tip"),n===3&&await s(!0)}await s(C(i.opponent.planes,i.my.shots));async function s(n){y(!0,e),n&&await A("my")}}async function B(e){i.opponent.shots.includes[e]||i.opponent.shots.push(e),y(!1,e),C(i.my.planes,i.opponent.shots)&&await A("opponent")}async function A(e){i.opponent.planes.forEach(t=>t.forEach(l=>document.querySelector(`#${a.opponentField} [cell='${l}']`).classList.add("plane")));let n=document.createElement("div");n.innerHTML=e==="my"?"You won :)":"You lost :(",n.classList.add(e==="my"?"won":"lost");let o=document.createElement("div");o.classList.add("game-over"),o.addEventListener("click",()=>location.reload()),o.appendChild(n),document.body.appendChild(o)}function C(e,s){let n=e.map(t=>t[0]);return s.filter(t=>n.includes(t)).length===2}function F(e,s){s.forEach((n,o)=>{let t=document.querySelector(`#${e} [cell='${n}']`);t.classList.add("plane"),o===0&&t.classList.add("tip")})}function y(e,s){let n=document.getElementById(e?a.opponentField:a.myField);s?o(s):e?i.my.shots.forEach(o):i.opponent.shots.forEach(o);function o(t){let l=n.querySelector(`[cell='${t}']`);l.classList.contains("hit")||l.classList.add("hit")}}function v(e,s,n,o,t,l){let c=s+(o?1:0),d=m("table");t&&d.setAttribute("id",t),l&&d.classList.add(l),new Array(c).fill().forEach((p,r)=>{let I=m("tr");new Array(c).fill().forEach((k,u)=>{let f=m("td");o&&r===0&&u===0?f.innerText="":o&&r===0&&u>0?f.innerText=u:o&&r>0&&u===0?f.innerText=_(r):f.setAttribute("cell",S(r+(o?0:1),u+(o?0:1))),I.appendChild(f)}),d.appendChild(I)}),d.addEventListener("click",p=>{if(p.preventDefault(),p.stopPropagation(),!n)return;let r=p.target.getAttribute("cell");r&&n(...E(r))}),e.appendChild(d)}function D(e,s,n){let t={1:["A2","B1","B2","B3","C2","D1","D2","D3"],2:["B4","A1","A3","B1","B2","B3","C1","C3"],3:["D2","A1","A2","A3","B2","C1","C2","C3"],4:["B1","A2","A4","B2","B3","B4","C2","C4"]}[e];return!s||!n?t:t.map(l=>{let c=E(l);return c[0]+=e===1?s-1:e==2||e==4?s-2:e===3?s-4:s,c[1]+=e===1||e===3?n-2:e==2?n-4:e===4?n-1:n,S(...c)})}function P(e,s,n,o,t){if(!(n===1&&o>=1&&o<=10-3&&t>=2&&t<=10-1||n===2&&o>=2&&o<=10-1&&t>=4&&t<=10||n===3&&o>=4&&o<=10&&t>=2&&t<=10-1||n===4&&o>=2&&o<=10-1&&t>=1&&t<=10-3))return;let l=D(n,o,t);s.find(d=>d.find(p=>l.includes(p))!==void 0)||(s.push(l),e==="my"&&F(a.myField,l))}function m(e){return document.createElement(e)}function h(e){return Math.ceil(Math.random()*e)}function E(e){return/^[A-Z]{1}([1-9]{1}|10)$/.test(e)?[e[0].charCodeAt()-64,+e.replace(/[A-Z]/,"")]:[NaN,NaN]}function S(e,s){return`${_(e)}${s}`}function _(e){return String.fromCharCode(64+e)}function T(){return i.my.shots<=i.opponent.shots}})();
        </script>
    </body>
</html>
